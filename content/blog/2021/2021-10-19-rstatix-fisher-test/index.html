---
title: rstatix使用fisher检验处理比例关系
author: 王诗翔
date: '2021-10-19'
slug: rstatix-fisher-test
categories:
  - Blog
tags:
  - R
  - stats
description: 通过例子学习工具
keywords: rstats
editor_options:
  chunk_output_type: console
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<!-- Links -->
<p>Fisher检验R默认就可以做，但是只支持一次检验，为了更好地处理数据，这篇文章通过rstatix包的相关功能来
学习一些新知识。</p>
<pre class="r"><code>library(rstatix)</code></pre>
<blockquote>
<p>本文的相关代码文档可以运行<code>?rstatix::fisher_test()</code>查看。</p>
</blockquote>
<div id="比较2个比例值" class="section level2">
<h2>比较2个比例值</h2>
<p>生成数据：</p>
<pre class="r"><code>xtab &lt;- as.table(rbind(c(490, 10), c(400, 100)))
dimnames(xtab) &lt;- list(
  group = c(&quot;grp1&quot;, &quot;grp2&quot;),
  smoker = c(&quot;yes&quot;, &quot;no&quot;)
)
xtab</code></pre>
<pre><code>##       smoker
## group  yes  no
##   grp1 490  10
##   grp2 400 100</code></pre>
<p>进行比较：</p>
<pre class="r"><code>fisher_test(xtab)</code></pre>
<pre><code>## # A tibble: 1 × 3
##       n        p p.signif
## * &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   
## 1  1000 8.77e-22 ****</code></pre>
<pre class="r"><code># 给出更多的比较信息
fisher_test(xtab, detailed = TRUE)</code></pre>
<pre><code>## # A tibble: 1 × 8
##       n estimate        p conf.low conf.high method         alternative p.signif
## * &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;   
## 1  1000     12.2 8.77e-22     6.27      26.6 Fisher&#39;s Exac… two.sided   ****</code></pre>
</div>
<div id="组间比例的同质性" class="section level2">
<h2>组间比例的同质性</h2>
<p>H0: the proportion of smokers is similar in the four groups</p>
<p>Ha: this proportion is different in at least one of the populations.</p>
<p>生成数据：</p>
<pre class="r"><code>grp.size &lt;- c( 106, 113, 156, 102 )
smokers  &lt;- c( 50, 100, 139, 80 )
no.smokers &lt;- grp.size - smokers
xtab &lt;- as.table(rbind(
  smokers,
  no.smokers
))
dimnames(xtab) &lt;- list(
  Smokers = c(&quot;Yes&quot;, &quot;No&quot;),
  Groups = c(&quot;grp1&quot;, &quot;grp2&quot;, &quot;grp3&quot;, &quot;grp4&quot;)
)
xtab</code></pre>
<pre><code>##        Groups
## Smokers grp1 grp2 grp3 grp4
##     Yes   50  100  139   80
##     No    56   13   17   22</code></pre>
<p>比较不同组别smokers的比例：</p>
<pre class="r"><code>fisher_test(xtab, detailed = TRUE)</code></pre>
<pre><code>## # A tibble: 1 × 5
##       n       p method              alternative p.signif
## * &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;       &lt;chr&gt;   
## 1   477 6.1e-15 Fisher&#39;s Exact test two.sided   ****</code></pre>
<p>不同组别的成对比较：</p>
<pre class="r"><code>pairwise_fisher_test(xtab)</code></pre>
<pre><code>## # A tibble: 6 × 6
##   group1 group2     n        p    p.adj p.adj.signif
## * &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       
## 1 grp1   grp2     219 2.39e-11 1.2 e-10 ****        
## 2 grp1   grp3     262 1.22e-13 7.32e-13 ****        
## 3 grp1   grp4     208 3.79e- 6 1.52e- 5 ****        
## 4 grp2   grp3     269 1   e+ 0 1   e+ 0 ns          
## 5 grp2   grp4     215 6.35e- 2 1.27e- 1 ns          
## 6 grp3   grp4     258 2.17e- 2 6.51e- 2 ns</code></pre>
</div>
<div id="成对比例检验" class="section level2">
<h2>成对比例检验</h2>
<p>生成数据：</p>
<pre class="r"><code># Data: Titanic
xtab &lt;- as.table(rbind(
  c(122, 167, 528, 673),
  c(203, 118, 178, 212)
))
dimnames(xtab) &lt;- list(
  Survived = c(&quot;No&quot;, &quot;Yes&quot;),
  Class = c(&quot;1st&quot;, &quot;2nd&quot;, &quot;3rd&quot;, &quot;Crew&quot;)
)
xtab</code></pre>
<pre><code>##         Class
## Survived 1st 2nd 3rd Crew
##      No  122 167 528  673
##      Yes 203 118 178  212</code></pre>
<p>比较不同组别的生存率：</p>
<pre class="r"><code>pairwise_fisher_test(xtab)</code></pre>
<pre><code>## # A tibble: 6 × 6
##   group1 group2     n        p    p.adj p.adj.signif
## * &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       
## 1 1st    2nd      610 2.78e- 7 8.34e- 7 ****        
## 2 1st    3rd     1031 3.68e-30 1.84e-29 ****        
## 3 1st    Crew    1210 1.81e-34 1.09e-33 ****        
## 4 2nd    3rd      991 8.19e- 7 1.64e- 6 ****        
## 5 2nd    Crew    1170 2.77e- 8 1.11e- 7 ****        
## 6 3rd    Crew    1591 5.98e- 1 5.98e- 1 ns</code></pre>
</div>
<div id="逐行比例检验" class="section level2">
<h2>逐行比例检验</h2>
<pre class="r"><code># Data: Titanic
xtab &lt;- as.table(rbind(
  c(180, 145), c(179, 106),
  c(510, 196), c(862, 23)
))
dimnames(xtab) &lt;- list(
  Class = c(&quot;1st&quot;, &quot;2nd&quot;, &quot;3rd&quot;, &quot;Crew&quot;),
  Gender = c(&quot;Male&quot;, &quot;Female&quot;)
)
xtab</code></pre>
<pre><code>##       Gender
## Class  Male Female
##   1st   180    145
##   2nd   179    106
##   3rd   510    196
##   Crew  862     23</code></pre>
<p>比较不同Class下男女的比例：</p>
<pre class="r"><code>row_wise_fisher_test(xtab)</code></pre>
<pre><code>## # A tibble: 4 × 5
##   group     n        p    p.adj p.adj.signif
## * &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;       
## 1 1st    2201 9.38e-25 2.81e-24 ****        
## 2 2nd    2201 3.96e-11 7.92e-11 ****        
## 3 3rd    2201 8.67e- 7 8.67e- 7 ****        
## 4 Crew   2201 8.02e-85 3.21e-84 ****</code></pre>
</div>
<div id="多行多列表格计算" class="section level2">
<h2>多行多列表格计算</h2>
<p>这个时候默认方法会超级慢，可能算不出来，我们可以更改下参数使用模拟操作。</p>
<pre class="r"><code># A r x c table  Agresti (2002, p. 57) Job Satisfaction
Job &lt;- matrix(c(1,2,1,0, 3,3,6,1, 10,10,14,9, 6,7,12,11), 4, 4,
              dimnames = list(income = c(&quot;&lt; 15k&quot;, &quot;15-25k&quot;, &quot;25-40k&quot;, &quot;&gt; 40k&quot;),
                             satisfaction = c(&quot;VeryD&quot;, &quot;LittleD&quot;, &quot;ModerateS&quot;, &quot;VeryS&quot;)))
fisher_test(Job)</code></pre>
<pre><code>## # A tibble: 1 × 3
##       n     p p.signif
## * &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1    96 0.783 ns</code></pre>
<pre class="r"><code>fisher_test(Job, simulate.p.value = TRUE, B = 1e5)</code></pre>
<pre><code>## # A tibble: 1 × 3
##       n     p p.signif
## * &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1    96 0.783 ns</code></pre>
</div>
