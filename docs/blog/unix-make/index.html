<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">

		
		<title>Unix：Make &middot; ShixiangWang
王诗翔</title>
		
		<meta property="og:title" content="Unix：Make - ShixiangWang
王诗翔">
		
		<meta property="og:type" content="article">
		

		
			
			<meta property="description" content="自动化Unix命令构建。">
			<meta property="og:description" content="自动化Unix命令构建。">
			
			
    	<meta property="twitter:card" content="summary">
  		<meta property="twitter:image" content="/apple-touch-icon-152x152.png">
			
		

		
		<meta property="keywords" content ="make">
		
		
		<meta name="twitter:creator" content="@WangShxiang">
		<meta name="twitter:site" content="https://shixiangwang.github.io">
		
		

		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
		<link rel="stylesheet" href="../../css/poole.css">
		<link rel="stylesheet" href="../../css/syntax.css">
		<link rel="stylesheet" href="../../css/hyde.css">
		
		
		<link rel="stylesheet" href="../../css/hamburgers.css">
		
		<link rel="stylesheet" href="../../css/custom.css">
		
		

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16" />
<meta name="application-name" content="Garrick Aden-Buie"/>
<meta name="msapplication-TileColor" content="#002B36" />
<meta name="msapplication-TileImage" content="/mstile-144x144.png" />
<meta name="theme-color" content="#ffffff">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Garrick Aden-Buie">

<link href="../../css/featherlight.min.css" type="text/css" rel="stylesheet" />

<script async defer src="https://buttons.github.io/buttons.js"></script>

<script defer src="../../js/van11y-accessible-hide-show-aria.min.js"></script>

<script defer src="../../js/toc.js"></script>



		<link href="../../blog/unix-make" rel="canonical">
	</head>

	<body class="restyled-garrick  h-entry">
		<main class="content container" role="main">
			<article class="post">
				<header>
					<a class="u-url" href="../../blog/unix-make">
						<h1 class="post-title p-name">Unix：Make</h1>
					</a>
					<h3 class="post-author">王诗翔</h3>
					<time class="post-date dt-published" datetime="2021-08-09T00:00:00Z">Monday, 9 August 2021</time>
					
				</header>
				<div class="post-content e-content">
					<p>2021/05/26 22:01</p>
<blockquote>
<p>原文：<a href="https://seankross.com/the-unix-workbench/working-with-unix.html#make">https://seankross.com/the-unix-workbench/working-with-unix.html#make</a></p>
</blockquote>
<p>从前没有网页浏览器、文件浏览器、开始菜单或搜索栏。当有人启动电脑时，他们得到的是一个shell提示符，他们做的所有工作都是从这个提示符开始的。那时候，人们仍然喜欢共享软件，但总是存在软件应该如何安装的问题。make程序是解决这个问题的最好的尝试，make的优雅使它至今仍被广泛使用。make的指导设计目标是为了安装一些新软件:</p>
<ol>
<li>
<p>将所有的依赖下载到一个目录。</p>
</li>
<li>
<p><code>cd</code>进入目录。</p>
</li>
<li>
<p>运行<code>make</code>。</p>
</li>
</ol>
<p>这是通过指定一个名为makefile的文件来实现的，<strong>该文件描述了不同文件和程序之间的关系</strong> 。除了安装程序之外，make对于自动创建文档也很有用。让我们构建一个makefile，它创建一个readme.txt文件，该文件自动填充有关当前目录的一些信息。</p>
<p>首先进入目录并创建一个文件：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-Bash" data-lang="Bash">▶ <span style="color:#008000">cd</span> ~/Documents/test                                                                                                         
▶ nano makefile
</code></pre></div><p>填入如下内容：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">draft_journal_entry.txt:
  touch draft_journal_entry.txt
</code></pre></div><p>上面简单的makefile说明了一个规则，它的一般格式如下：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">[target]: [dependencies...]
  [commands...]
</code></pre></div><p>在这个简单的示例中，我们创建了以<code>draft_journal_entry.txt</code>为目标的文件，该文件是作为命令的结果创建的。需要注意的是，目标下的任何命令都必须用<code>Tab</code>缩进。如果我们不使用<code>Tab</code> 来缩进命令，那么<code>make</code>将失败。让我们保存并关闭makefile，然后我们可以在控制台中运行以下命令：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-Bash" data-lang="Bash">▶ ls
makefile
</code></pre></div><p>然后使用下面的操作查看<code>make</code>使用方式：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-Bash" data-lang="Bash">▶ make draft_journal_entry.txt
touch draft_journal_entry.txt                                                                                                     
▶ ls
draft_journal_entry.txt makefile
</code></pre></div><p>在我们为<code>draft_journal_entry.txt</code>目标定义的规则下缩进的命令已经执行，所以现在<code>draft_journal_entry.txt</code>存在！让我们再次运行相同的<code>make</code>命令：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ make draft_journal_entry.txt
make: <span style="color:#ba2121">`</span>draft_journal_entry.txt<span style="">&#39;</span> is up to date.
</code></pre></div><p>因为目标文件已经存在，所以没有采取任何操作，相反，我们被告知，<code>draft_journal_entry.txt</code>的规则是“最新的”(没有什么需要做的)。</p>
<p>如果我们看一下我们之前草拟的一般规则格式，我们可以看到我们没有为该规则指定任何依赖项。依赖项是目标在构建时所依赖的文件。如果自上次为目标运行<code>make</code>以来，依赖项已经更新，则目标不是“最新的”。这意味着下次为该目标运行<code>make</code>时将运行该目标的命令。通过这种方式，对依赖项的更改被合并到目标中。为了避免不必要地运行命令，这些命令只在依赖项改变时运行，或者当目标根本不存在时运行。</p>
<p>让我们更新<code>makefile</code>，以包含自动生成的<code>readme.txt</code>。首先，让我们添加文件：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ <span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;1. 2017-06-15-In-Boston&#34;</span> &gt; toc.txt
</code></pre></div><p><code>makefile</code>修改为：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">draft_journal_entry.txt:
  touch draft_journal_entry.txt
  
readme.txt: toc.txt
  echo &#34;This journal contains the following number of entries:&#34; &gt; readme.txt
  wc -l toc.txt | egrep -o &#34;[0-9]+&#34; &gt;&gt; readme.txt
</code></pre></div><p>运行下面命令：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ make readme.txt
<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;This journal contains the following number of entries:&#34;</span> &gt; readme.txt
wc -l toc.txt | egrep -o <span style="color:#ba2121">&#34;[0-9]+&#34;</span> &gt;&gt; readme.txt
</code></pre></div><p>看一下<code>readme.txt</code>：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ cat readme.txt 
This journal contains the following number of entries:
<span style="color:#666">1</span>
</code></pre></div><p>再次运行：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ make readme.txt 
make: <span style="color:#ba2121">`</span>readme.txt<span style="">&#39;</span> is up to date.
</code></pre></div><p>修改<code>toc.txt</code>后再次运行：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ <span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;2. 2017-06-16-IQSS-Talk&#34;</span> &gt;&gt; toc.txt
▶ make readme.txt
<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;This journal contains the following number of entries:&#34;</span> &gt; readme.txt
wc -l toc.txt | egrep -o <span style="color:#ba2121">&#34;[0-9]+&#34;</span> &gt;&gt; readme.txt

▶ cat readme.txt                           
This journal contains the following number of entries:
<span style="color:#666">2</span> 
</code></pre></div><p>为了简化<code>make</code>体验，我们可以在<code>makefile</code>的顶部创建一个名为<code>all</code>的规则，在该规则中我们可以列出由<code>makefile</code>构建的所有文件。通过添加<code>all</code>目标，我们可以在不带任何参数的情况下运行<code>make</code>来构建<code>makefile</code>中的所有目标。让我们打开nano并添加以下规则：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">all: draft_journal_entry.txt readme.txt

draft_journal_entry.txt:
  touch draft_journal_entry.txt
  
readme.txt: toc.txt
  echo &#34;This journal contains the following number of entries:&#34; &gt; readme.txt
  wc -l toc.txt | egrep -o &#34;[0-9]+&#34; &gt;&gt; readme.txt
</code></pre></div><p>同时让我们在<code>makefile</code>的末尾添加另一个特殊的规则<code>clean</code>，它会销毁由我们的<code>makefile</code>创建的文件：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-fallback" data-lang="fallback">all: draft_journal_entry.txt readme.txt

draft_journal_entry.txt:
  touch draft_journal_entry.txt
  
readme.txt: toc.txt
  echo &#34;This journal contains the following number of entries:&#34; &gt; readme.txt
  wc -l toc.txt | egrep -o &#34;[0-9]+&#34; &gt;&gt; readme.txt
  
clean:
  rm draft_journal_entry.txt
  rm readme.txt
</code></pre></div><p>首先让我们清理下我们的目录：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ make clean
rm draft_journal_entry.txt
rm readme.txt                                                                                                     
▶ ls
makefile toc.txt
</code></pre></div><p>然后重新构建：</p>
<div class="highlight"><pre style=";-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">▶ make
touch draft_journal_entry.txt
<span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;This journal contains the following number of entries:&#34;</span> &gt; readme.txt
wc -l toc.txt | egrep -o <span style="color:#ba2121">&#34;[0-9]+&#34;</span> &gt;&gt; readme.txt
                                                                                                     
▶ ls
draft_journal_entry.txt makefile                readme.txt              toc.txt
</code></pre></div>
				</div>
				<footer class="footer">
				  <hr>
<div class="post-tags">

<p>
  <svg xmlns="http://www.w3.org/2000/svg" class="octicon" width="20" height="24" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M8 2H6V0h2v2zm4 5H2c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h10l2 2-2 2zM8 4H6v2h2V4zM6 16h2V8H6v8z"/></svg>
	
	<a class="p-category" href="../../categories/blog/">Blog</a>
</p>


<p>
  <svg xmlns="http://www.w3.org/2000/svg" class="octicon" width="20" height="24" viewBox="0 0 15 16"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 0 0 0-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"/></svg>
	
	<a class="p-tag" href="../../tags/unix/">Unix</a><a class="p-tag" href="../../tags/%E8%87%AA%E5%8A%A8%E5%8C%96/">自动化</a><a class="p-tag" href="../../tags/%E5%AD%A6%E4%B9%A0/">学习</a>

</p>
</div>

				</footer>
			</article>
		</main>
			  <button class="hamburger hamburger--arrow is-active" type="button" onclick="document.getElementsByClassName('sidebar')[0].classList.toggle('collapsed');document.getElementsByClassName('content')[0].classList.toggle('expanded');document.getElementsByClassName('hamburger')[0].classList.toggle('is-active');document.getElementsByClassName('hamburger-inner')[0].classList.toggle('is-active')">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
		<aside class="sidebar">
			<div class="container sidebar-sticky">
				<header class="sidebar-about h-card vcard p-author">
					
					<a class="u-url u-uid" rel="me" href="../../">
						<img class="u-photo" src="https://avatars.githubusercontent.com/u/25057508?v=4" width=128 height=128 />
					</a>
					

					
					<span class="site-title u-name fn">
					  <a class="u-url u-uid" rel="me" href="../../">ShixiangWang
王诗翔</a>
				  </span>
					

					<p class="lead p-note">
						 Bioinformatics Scholar. Cancer Researcher. Data Scientist. #rstats #python #rust. Always learning something new. 
					</p>

					<nav>
						<ul class="sidebar-nav">
							
							<li><a href="../../about/"> About </a></li>
							
							<li><a href="../../blog/"> Blog </a></li>
							
							<li><a href="../../project/"> Projects </a></li>
							
							<li><a href="http://42.192.87.178:3838/"> Shiny Apps </a></li>
							
							<li><a href="../../talk/"> Talks </a></li>
							
							<li><a href="https://github.com/ShixiangWang/self-study/discussions"> Discuss with me? </a></li>
							
							<li><a href="https://shixiangwang.netlify.app/"> Mirror #1 </a></li>
							
							<li><a href="https://shixiangwang.github.io/"> Mirror #2 </a></li>
							
						</ul>
					</nav>

					
						<div class="contact">
						  
							<ul class="contact-list">
								
								<li>
									
									  
		  							  <a href="https://twitter.com/WangShxiang" class="u-url url" rel="me" title="Twitter" aria-label="Twitter">
		  						    <i class='fab fa-twitter fa-fw'></i>
		  							  </a>
		  						  
								
								</li>
								
								<li>
									
									  
		  							  <a href="https://github.com/ShixiangWang" class="u-url url" rel="me" title="GitHub" aria-label="GitHub">
		  						    <i class='fab fa-github fa-fw'></i>
		  							  </a>
		  						  
								
								</li>
								
								<li>
									
		  							<a href="mailto:shixiang1994wang@gmail.com" class="u-email email" rel="me" title="Email" aria-label="Email">
		  							<i class='fa fa-envelope fa-fw'></i>
		  							  
		  							</a>
									
								</li>
								
								<li>
									
									  
		  							  <a href="https://shixiangwang.github.io/home/logo/qrcode.jpg" class="u-url url" rel="me" title="Bandcamp" aria-label="Bandcamp">
		  						    <i class='fab fa-bandcamp fa-fw'></i>
		  							  </a>
		  						  
								
								</li>
								
							</ul>
						</div>
					
				</header>

				<footer>&copy; 2021. All rights reserved. </footer>
				 <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_pv">本站总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;次</span>
			</div>
		</aside>

		  <footer>
  <script src="../../js/jquery-latest.js"></script>
<script src="../../js/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
  </footer>
  </body>
</html>

	</body>
</html>
