<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1">

		
		<title>ezcox v1.0.2 更新 &middot; ShixiangWang
(王诗翔)</title>
		
		<meta property="og:title" content="ezcox v1.0.2 更新 - ShixiangWang
(王诗翔)">
		
		<meta property="og:type" content="article">
		

		
			
			<meta property="description" content="支持了交互项和修正了一个画图问题">
			<meta property="og:description" content="支持了交互项和修正了一个画图问题">
			
			
    	<meta property="twitter:card" content="summary">
  		<meta property="twitter:image" content="/apple-touch-icon-152x152.png">
			
		

		
		
		<meta name="twitter:creator" content="@WangShxiang">
		<meta name="twitter:site" content="https://shixiangwang.github.io">
		
		

		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
		<link rel="stylesheet" href="../../css/poole.css">
		<link rel="stylesheet" href="../../css/syntax.css">
		<link rel="stylesheet" href="../../css/hyde.css">
		
		
		<link rel="stylesheet" href="../../css/hamburgers.css">
		
		<link rel="stylesheet" href="../../css/custom.css">
		
		

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="../../favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="../../favicon-16x16.png" sizes="16x16" />
<meta name="application-name" content="Garrick Aden-Buie"/>
<meta name="msapplication-TileColor" content="#002B36" />
<meta name="msapplication-TileImage" content="/mstile-144x144.png" />
<meta name="theme-color" content="#ffffff">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="Garrick Aden-Buie">

<link href="../../css/featherlight.min.css" type="text/css" rel="stylesheet" />

<script async defer src="https://buttons.github.io/buttons.js"></script>

<script defer src="../../js/van11y-accessible-hide-show-aria.min.js"></script>

<script defer src="../../js/toc.js"></script>



		<link href="../../blog/ezcox-v1-2-update" rel="canonical">
	</head>

	<body class="restyled-garrick  h-entry">
		<main class="content container" role="main">
			<article class="post">
				<header>
					<a class="u-url" href="../../blog/ezcox-v1-2-update">
						<h1 class="post-title p-name">ezcox v1.0.2 更新</h1>
					</a>
					<h3 class="post-author">王诗翔</h3>
					<time class="post-date dt-published" datetime="2021-10-22T00:00:00Z">Friday, 22 October 2021</time>
					
				</header>
				<div class="post-content e-content">
					
<script src="../../blog/ezcox-v1-2-update/index_files/header-attrs/header-attrs.js"></script>


<!-- Links -->
<p>针对<code>@lijing-lin</code>在GitHub的ezcox仓库提出的<a href="https://github.com/ShixiangWang/ezcox/issues/23">Fast way to add interaction terms?</a>问题，
这两天闲暇时废了些脑细胞进行解决。同时也fix之前记录的一个遗留问题。</p>
<pre class="r"><code>remotes::install_github(&quot;ShixiangWang/ezcox&quot;)</code></pre>
<div id="交互项支持" class="section level2">
<h2>交互项支持</h2>
<p>之前为了解决用户数据列名不符合的R命名规则，在源代码例自动对不合法名字进行了反撇号标记。
这会导致R的公式没法进行解析，例如<code>sex:age</code>会被判断为一个列名，R的公式没法解析它，因为
找不到数据中对应的<code>sex:age</code>列，所以会报错。</p>
<pre class="r"><code>library(survival)
library(ezcox)

lung$ph.ecog &lt;- factor(lung$ph.ecog)
ezcox(lung, covariates = c(&quot;age&quot;), controls = &quot;sex:ph.ecog&quot;)</code></pre>
<pre><code>## # A tibble: 5 × 12
##   Variable is_control contrast_level ref_level n_contrast n_ref     beta    HR
##   &lt;chr&gt;    &lt;lgl&gt;      &lt;chr&gt;          &lt;lgl&gt;     &lt;lgl&gt;      &lt;lgl&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1 age      FALSE      age            NA        NA         NA     0.00844 1.01 
## 2 age      TRUE       sex:ph.ecog0   NA        NA         NA    -0.890   0.411
## 3 age      TRUE       sex:ph.ecog1   NA        NA         NA    -0.580   0.560
## 4 age      TRUE       sex:ph.ecog2   NA        NA         NA    -0.236   0.790
## 5 age      TRUE       sex:ph.ecog3   NA        NA         NA     0.967   2.63 
## # … with 4 more variables: lower_95 &lt;dbl&gt;, upper_95 &lt;dbl&gt;, p.value &lt;dbl&gt;,
## #   global.pval &lt;dbl&gt;</code></pre>
<p>另外，一些数据的计算会由于交互项的引入带来麻烦，我选择将一些结果列直接赋值为<code>NA</code>来消除。
所以新的特性的实现是有一些代价的。</p>
<p>另外值得注意的时，由于<code>forestmodel</code>包不支持提取交互项的数据，在绘图时会被自动忽略。</p>
<pre class="r"><code>show_forest(lung, covariates = c(&quot;age&quot;, &quot;wt.loss&quot;), controls = &quot;sex:ph.ecog&quot;)</code></pre>
<p><img src="../../blog/ezcox-v1-2-update/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="ezcox_group乱序问题" class="section level2">
<h2><code>ezcox_group()</code>乱序问题</h2>
<p>在之前的版本中下面的代码运行后所有数据生成的<code>ALL</code>组会跑到中间去，本次版本进行了修复，
确保它位于最后一个。</p>
<pre class="r"><code>lung$sex &lt;- ifelse(lung$sex == 1, &quot;Male&quot;, &quot;Female&quot;)

ezcox_group(lung, grp_var = &quot;sex&quot;,
            covariate = &quot;ph.ecog&quot;, controls = &quot;age&quot;, add_all = TRUE)</code></pre>
<pre><code>## $data
## $stats
## # A tibble: 12 × 13
##    Group  Variable is_control contrast_level ref_level n_contrast n_ref    beta
##    &lt;chr&gt;  &lt;chr&gt;    &lt;lgl&gt;      &lt;chr&gt;          &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 ALL    ph.ecog  FALSE      1              0                113    63  0.359 
##  2 ALL    ph.ecog  FALSE      2              0                 50    63  0.857 
##  3 ALL    ph.ecog  FALSE      3              0                  1    63  2.11  
##  4 ALL    ph.ecog  TRUE       age            age              228   228  0.0108
##  5 Female ph.ecog  FALSE      1              0                 42    27  0.439 
##  6 Female ph.ecog  FALSE      2              0                 21    27  1.41  
##  7 Female ph.ecog  FALSE      3              0                  0    27 NA     
##  8 Female ph.ecog  TRUE       age            age               90    90 -0.0153
##  9 Male   ph.ecog  FALSE      1              0                 71    36  0.353 
## 10 Male   ph.ecog  FALSE      2              0                 29    36  0.809 
## 11 Male   ph.ecog  FALSE      3              0                  1    36  1.77  
## 12 Male   ph.ecog  TRUE       age            age              138   138  0.0182
## # … with 5 more variables: HR &lt;dbl&gt;, lower_95 &lt;dbl&gt;, upper_95 &lt;dbl&gt;,
## #   p.value &lt;dbl&gt;, global.pval &lt;dbl&gt;
## 
## $models
## # A tibble: 3 × 6
##   Group  Variable control model_file                               model  status
##   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                                    &lt;list&gt; &lt;lgl&gt; 
## 1 ALL    ph.ecog  age     /Volumes/Extra/R/Rtmp//Rtmp9B6ubK/ezcox… &lt;coxp… TRUE  
## 2 Female ph.ecog  age     /Volumes/Extra/R/Rtmp//Rtmp9B6ubK/ezcox… &lt;coxp… TRUE  
## 3 Male   ph.ecog  age     /Volumes/Extra/R/Rtmp//Rtmp9B6ubK/ezcox… &lt;coxp… TRUE  
## 
## attr(,&quot;class&quot;)
## [1] &quot;ezcox&quot;
## 
## $plot</code></pre>
<p><img src="../../blog/ezcox-v1-2-update/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>

				</div>
				<footer class="footer">
				  <hr>
<div class="post-tags">

<p>
  <svg xmlns="http://www.w3.org/2000/svg" class="octicon" width="20" height="24" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M8 2H6V0h2v2zm4 5H2c-.55 0-1-.45-1-1V4c0-.55.45-1 1-1h10l2 2-2 2zM8 4H6v2h2V4zM6 16h2V8H6v8z"/></svg>
	
	<a class="p-category" href="../../categories/blog/">Blog</a>
</p>


<p>
  <svg xmlns="http://www.w3.org/2000/svg" class="octicon" width="20" height="24" viewBox="0 0 15 16"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41 0l4.59-4.59a.996.996 0 0 0 0-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42 0 .83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z"/></svg>
	
	<a class="p-tag" href="../../tags/r/">R</a><a class="p-tag" href="../../tags/ezcox/">ezcox</a>

</p>
</div>

				</footer>
			</article>
		</main>
			  <button class="hamburger hamburger--arrow is-active" type="button" onclick="document.getElementsByClassName('sidebar')[0].classList.toggle('collapsed');document.getElementsByClassName('content')[0].classList.toggle('expanded');document.getElementsByClassName('hamburger')[0].classList.toggle('is-active');document.getElementsByClassName('hamburger-inner')[0].classList.toggle('is-active')">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
		<aside class="sidebar">
			<div class="container sidebar-sticky">
				<header class="sidebar-about h-card vcard p-author">
					
					<a class="u-url u-uid" rel="me" href="../../">
						<img class="u-photo" src="https://avatars.githubusercontent.com/u/25057508?v=4" width=128 height=128 />
					</a>
					

					
					<span class="site-title u-name fn">
					  <a class="u-url u-uid" rel="me" href="../../">ShixiangWang
(王诗翔)</a>
				  </span>
					

					<p class="lead p-note">
						 Bioinformatics Scholar. Cancer Researcher. Data Scientist. Always learning something new. 
					</p>

					<nav>
						<ul class="sidebar-nav">
							
							<li><a href="../../about/"> About </a></li>
							
							<li><a href="../../blog/"> Blog </a></li>
							
							<li><a href="../../project/"> Projects </a></li>
							
							<li><a href="http://42.192.87.178:3838/"> Shiny Apps </a></li>
							
							<li><a href="../../talk/"> Talks </a></li>
							
							<li><a href="https://github.com/ShixiangWang/self-study/discussions"> Discuss with me? </a></li>
							
							<li><a href="https://shixiangwang.netlify.app/"> Mirror #1 </a></li>
							
							<li><a href="https://shixiangwang.github.io/"> Mirror #2 </a></li>
							
						</ul>
					</nav>

					
						<div class="contact">
						  
							<ul class="contact-list">
								
								<li>
									
									  
		  							  <a href="https://twitter.com/WangShxiang" class="u-url url" rel="me" title="Twitter" aria-label="Twitter">
		  						    <i class='fab fa-twitter fa-fw'></i>
		  							  </a>
		  						  
								
								</li>
								
								<li>
									
									  
		  							  <a href="https://github.com/ShixiangWang" class="u-url url" rel="me" title="GitHub" aria-label="GitHub">
		  						    <i class='fab fa-github fa-fw'></i>
		  							  </a>
		  						  
								
								</li>
								
								<li>
									
		  							<a href="mailto:shixiang1994wang@gmail.com" class="u-email email" rel="me" title="Email" aria-label="Email">
		  							<i class='fa fa-envelope fa-fw'></i>
		  							  
		  							</a>
									
								</li>
								
								<li>
									
									  
		  							  <a href="https://shixiangwang.github.io/home/logo/qrcode.jpg" class="u-url url" rel="me" title="Bandcamp" aria-label="Bandcamp">
		  						    <i class='fab fa-bandcamp fa-fw'></i>
		  							  </a>
		  						  
								
								</li>
								
							</ul>
						</div>
					
				</header>

				<footer>&copy; 2021. All rights reserved. </footer>
				 <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container_site_pv">本站总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>&nbsp;次</span>
			</div>
		</aside>

		  <footer>
  <script src="../../js/jquery-latest.js"></script>
<script src="../../js/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
  
  </footer>
  </body>
</html>

	</body>
</html>
