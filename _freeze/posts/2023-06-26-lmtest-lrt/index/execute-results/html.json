{
  "hash": "568a2b20d9bd978de7e7587229ac0fc4",
  "result": {
    "markdown": "---\ntitle: lmtest 似然比检验Likelihood Ratio Test 比较两个线性模型\nauthor: Shixiang Wang\ndate: 2023-06-26\ncategories: [stats,R]\ndraft: false\ndescription: ''\n\ntoc: true\n\nformat:\n  html:\n    code-fold: false\n    code-overflow: wrap\n    code-tools: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lmtest)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: zoo\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n```{.r .cell-code}\n## with data from Greene (1993):\n## load data and compute lags\ndata(\"USDistLag\")\nusdl <- na.contiguous(cbind(USDistLag, lag(USDistLag, k = -1)))\ncolnames(usdl) <- c(\"con\", \"gnp\", \"con1\", \"gnp1\")\n\nfm1 <- lm(con ~ gnp + gnp1, data = usdl)\nfm2 <- lm(con ~ gnp + con1 + gnp1, data = usdl)\n\n## various equivalent specifications of the LR test\n## 下面4种操作方法是等价的\nlrtest(fm2, fm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: con ~ gnp + con1 + gnp1\nModel 2: con ~ gnp + gnp1\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   5 -56.069                         \n2   4 -65.871 -1 19.605  9.524e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nlrtest(fm2, 2) # Remove variable with idx 2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: con ~ gnp + con1 + gnp1\nModel 2: con ~ gnp + gnp1\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   5 -56.069                         \n2   4 -65.871 -1 19.605  9.524e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nlrtest(fm2, \"con1\") # Remove variable cond 1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: con ~ gnp + con1 + gnp1\nModel 2: con ~ gnp + gnp1\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   5 -56.069                         \n2   4 -65.871 -1 19.605  9.524e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\nlrtest(fm2, . ~ . - con1)  # Remove con1 by formula\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: con ~ gnp + con1 + gnp1\nModel 2: con ~ gnp + gnp1\n  #Df  LogLik Df  Chisq Pr(>Chisq)    \n1   5 -56.069                         \n2   4 -65.871 -1 19.605  9.524e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nSurvival 模型交互项：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survival)\n\nfit2 = coxph(Surv(time, status) ~ age + sex*factor(ph.ecog), data = lung)\nlmtest::lrtest(fit2, . ~ . - sex:factor(ph.ecog))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLikelihood ratio test\n\nModel 1: Surv(time, status) ~ age + sex * factor(ph.ecog)\nModel 2: Surv(time, status) ~ age + sex + factor(ph.ecog)\n  #Df  LogLik Df  Chisq Pr(>Chisq)\n1   7 -728.93                     \n2   5 -729.05 -2 0.2263      0.893\n```\n:::\n\n```{.r .cell-code}\nsummary(fit2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCall:\ncoxph(formula = Surv(time, status) ~ age + sex * factor(ph.ecog), \n    data = lung)\n\n  n= 227, number of events= 164 \n   (1 observation deleted due to missingness)\n\n                          coef exp(coef)  se(coef)      z Pr(>|z|)  \nage                   0.009667  1.009714  0.009601  1.007   0.3140  \nsex                  -0.641345  0.526583  0.385890 -1.662   0.0965 .\nfactor(ph.ecog)1      0.335017  1.397964  0.609291  0.550   0.5824  \nfactor(ph.ecog)2      0.618092  1.855384  0.686960  0.900   0.3683  \nfactor(ph.ecog)3      1.941570  6.969687  1.033409  1.879   0.0603 .\nsex:factor(ph.ecog)1  0.063350  1.065400  0.451918  0.140   0.8885  \nsex:factor(ph.ecog)2  0.221865  1.248403  0.507016  0.438   0.6617  \nsex:factor(ph.ecog)3        NA        NA  0.000000     NA       NA  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n                     exp(coef) exp(-coef) lower .95 upper .95\nage                     1.0097     0.9904    0.9909     1.029\nsex                     0.5266     1.8990    0.2472     1.122\nfactor(ph.ecog)1        1.3980     0.7153    0.4235     4.615\nfactor(ph.ecog)2        1.8554     0.5390    0.4827     7.131\nfactor(ph.ecog)3        6.9697     0.1435    0.9195    52.827\nsex:factor(ph.ecog)1    1.0654     0.9386    0.4394     2.583\nsex:factor(ph.ecog)2    1.2484     0.8010    0.4621     3.372\nsex:factor(ph.ecog)3        NA         NA        NA        NA\n\nConcordance= 0.636  (se = 0.025 )\nLikelihood ratio test= 31.09  on 7 df,   p=6e-05\nWald test            = 30.72  on 7 df,   p=7e-05\nScore (logrank) test = 33.92  on 7 df,   p=2e-05\n```\n:::\n:::\n\n\n除了用 likelihood ratio test，还可以使用 `anova()` 去对比。\n\n但如果数据不一致时，上述模型无法见效。这时，应把不同的对比作为变量构建模型，然后可以采用 `aov()` 进行方差分析，看变量是否显著以评估是否有组间差异。",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}