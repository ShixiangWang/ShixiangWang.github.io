{
  "hash": "60383eb0b69b819b4b8c813f68cbac11",
  "result": {
    "markdown": "---\ntitle: Single-cell Workshop 2021 - 03 - ç»†èƒç›¸äº’ä½œç”¨åˆ†æ\nauthor: Shixiang Wang\ndate: 2023-07-31\ncategories: [note,scRNA-seq,R]\ndraft: false\ndescription: ''\n\ntoc: true\n\nformat:\n  html:\n    code-fold: false\n    code-overflow: wrap\n    code-tools: false\n---\n\n\nå­¦ä¹ èµ„æ–™ï¼š[GitHub åœ°å€](https://github.com/pkuerten/single_cell_interaction.github.io/blob/main/index.md)\n\n## å°´å°¬äº†ï¼Œæµç¨‹è·‘ä¸é€š\n\nè¿™ä¸ªæ•™ç¨‹åœ¨è¿è¡Œåˆ° `predict_ligand_activities()` å°±å‡ºç°äº†é—®é¢˜ã€‚åé¢å°±èµ°ä¸ä¸‹å»äº†ã€‚\n\n```\npredict_ligand_activities(geneset = geneset_oi, background_expressed_genes = background_expressed_genes, ligand_target_matrix = ligand_target_matrix, potential_\n    ligands = potential_ligands)\nError in evaluate_target_prediction(setting, ligand_target_matrix, ligands_position) : \n  all genes have same response\n```\n\næˆ‘è‡ªå·±ä¹Ÿæ‡’å¾—æŠ˜è…¾äº†ï¼Œæœ¬èº«å°±æ˜¯æƒ³ç®€å•å­¦ä¹ äº†è§£æµç¨‹ï¼Œèµ°ä¸é€šå°±ä¸èµ°äº†ã€‚å¦‚æœæœ‰è¯»è€…çœ‹åˆ°è¿™ä¸ªæ–‡ç« ï¼Œæ„Ÿå…´è¶£å¯ä»¥é’»ç ”ä¸‹ã€‚\n\næˆ‘æŸ¥äº†ä¸‹ï¼Œ[Comparison of methods and resources for cell-cell communication inference from single-cell RNA-Seq data](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9184522/) æ˜¾ç¤ºCellChatã€CellPhoneDBå’ŒSingleCellSignalRï¼Œå¯¹æ•°æ®å’Œèµ„æºä¸­çš„å™ªå£°éƒ½ç›¸å½“ç¨³å¥ã€‚å› è€ŒNicheNetå¹¶ä¸åœ¨æ¨èèŒƒå›´å†…ã€‚\n\nä¸è¿‡ä¹Ÿæåˆ°ï¼š\n\n> Methods that additionally infer intracellular processes, such as NicheNet19, Cytotalk22, and SoptSC20 are not directly comparable but instead provide complementary analyses.\n\nè¯´æ˜ç›®å‰çœ‹ï¼Œè¿˜æ˜¯æœ‰ä¸€äº›ç‰¹å®šçš„åˆ†ææœ‰å¯å–ä¹‹å¤„ã€‚\n\n## æ•°æ®ä¸‹è½½\n\næˆ‘ä»¬å°†ä½¿ç”¨SeuratDataè½¯ä»¶åŒ…æä¾›çš„PBMCæ•°æ®é›†ã€‚è¯¥æ•°æ®é›†åŒ…å«ä¸¤ä¸ªPBMCæ ·æœ¬ï¼šç»è¿‡IFN Betaå¤„ç†çš„åˆºæ¿€æ ·æœ¬å’Œå¯¹ç…§æ ·æœ¬ã€‚\n\nå¯¹äºç»†èƒäº¤äº’åˆ†æï¼Œæˆ‘ä»¬å°†ä½¿ç”¨NicheNetï¼Œå®ƒéœ€è¦ä¸€äº›ç²¾å¿ƒç­–åˆ’çš„æ•°æ®é›†ã€‚è™½ç„¶è¿™äº›æ•°æ®é›†å¯ä»¥åœ¨Rç¯å¢ƒå†…ä¸‹è½½ï¼Œä½†å¯¹æˆ‘æ¥è¯´ä¸‹è½½é€Ÿåº¦å¤ªæ…¢äº†ã€‚è¿™äº›æ–‡ä»¶å¯ä»¥ä»Zenodoä¸‹ï¼ˆ<https://zenodo.org/record/3260758>ï¼‰è½½ï¼šgr_network.rdsã€ligand_target_matrix.rdsã€lr_network.rdså’Œweighted_networks.rdsã€‚\n\nè¯·å°†è¿™äº›æ•°æ®é›†æ”¾åˆ°ä½ çš„å·¥ä½œç›®å½•ä¸­ã€‚\n\n## å‡†å¤‡\n\næœ¬æ–‡å‚è€ƒ Seurat [æ•°æ®æ•´åˆæ–‡æ¡£è¿›è¡Œåˆ†æçš„è¾“å…¥æ•°æ®å‡†å¤‡](https://satijalab.org/seurat/articles/integration_introduction.html)ï¼Œå‡è®¾ä½ å¯¹æ•°æ®é¢„å¤„ç†éƒ¨åˆ†å·²ç»å¾ˆç†Ÿæ‚‰ã€‚\n\n## å®‰è£…åŒ…\n\nå®‰è£…æ‰€éœ€è¦çš„åŒ…ã€‚\n\n```R\nBiocManager::install(\"limma\")\nBiocManager::install(\"glmGamPoi\")\n# install.packages(\"devtools\")\ninstall.packages(\"https://seurat.nygenome.org/src/contrib/ifnb.SeuratData_3.0.0.tar.gz\", repos = NULL, type = \"source\") \ndevtools::install_github(\"saeyslab/nichenetr\")\n# å¯ä»¥ä¸‹è½½ä¹‹åå®‰è£…ï¼Œé¿å…å®‰è£…ä¸ä¸Š\n# https://github.com/saeyslab/nichenetr\n# unzip(\"~/Downloads/nichenetr-master.zip\")\n# ç¼ºä»€ä¹ˆè£…ä»€ä¹ˆ\n# BiocManager::install(c(\"fdrtool\", \"DiagrammeR\", \"mlrMBO\", \"parallelMap\", \"emoa\", \"DiceKriging\"))\n# install.packages(\"nichenetr-master\", repos = NULL, type = \"source\")\ninstall.packages(\"tidyverse\")\n```\n\nåŠ è½½åŒ…ï¼š\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load into your session\nlibrary(ifnb.SeuratData)\nlibrary(Seurat)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nAttaching SeuratObject\n```\n:::\n\n```{.r .cell-code}\n# load dataset\ndata(\"ifnb\")\n```\n:::\n\n\n## è¯»å–æ•°æ®é›†å¹¶åˆ›å»ºä¸€ä¸ªSeuratå¯¹è±¡\n\nç¬¬ä¸€æ­¥æ˜¯ä»SeuratDataè½¯ä»¶åŒ…ä¸­è¯»å–æ•°æ®ã€‚è¾“å…¥æ•°æ®æ ¹æ®æ ·æœ¬è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶åˆ†åˆ«åº”ç”¨SCtranformã€‚è¯·æ³¨æ„ï¼Œè¿™å–ä»£äº†NormalizeDataã€ScaleDataå’ŒFindVariableFeaturesçš„æ­¥éª¤ã€‚SCTransformæ˜¯ä¸€ç§ä¸“é—¨è®¾è®¡ç”¨äºå•ç»†èƒUMIè®¡æ•°æ•°æ®çš„ç»Ÿè®¡æ–¹æ³•ã€‚å®ƒå…‹æœäº†ä¹‹å‰æ‰¹é‡è®¾è®¡çš„å½’ä¸€åŒ–æ–¹æ³•ä¸­ä¸€äº›è¿‡åº¦æ‹Ÿåˆçš„é™åˆ¶ã€‚æœ‰å…³å…¶ä¼˜åŠ¿çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨[SCtranformçš„è®ºæ–‡](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-019-1874-1)ä¸­æ‰¾åˆ°ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰åº”ç”¨ä»»ä½•è´¨æ§æ­¥éª¤ã€‚è¿™æ˜¯å› ä¸ºæ•°æ®å·²ç»é¢„å…ˆæ¸…æ´ï¼Œå› æ­¤æ— éœ€é‡å¤è¿™äº›æ­¥éª¤ã€‚\n\n\n::: {.cell}\n\n```{.r .cell-code}\nifnb.list <- SplitObject(ifnb, split.by = \"stim\")\nifnb.list <- lapply(X = ifnb.list, FUN = SCTransform, method = \"glmGamPoi\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cell attributes from input UMI matrix: log_umi\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nVariance stabilizing transformation of count matrix of size 12747 by 6548\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nModel formula is y ~ log_umi\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nGet Negative Binomial regression parameters per gene\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nUsing 2000 genes, 5000 cells\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nFound 95 outliers - those will be ignored in fitting/regularization step\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSecond step: Get residuals using fitted parameters for 12747 genes\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nComputing corrected count matrix for 12747 genes\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating gene attributes\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWall clock passed: Time difference of 31.92474 secs\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nDetermine variable features\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nPlace corrected count matrix in counts slot\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCentering data matrix\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSet default assay to SCT\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating cell attributes from input UMI matrix: log_umi\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nVariance stabilizing transformation of count matrix of size 12658 by 7451\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nModel formula is y ~ log_umi\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nGet Negative Binomial regression parameters per gene\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nUsing 2000 genes, 5000 cells\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================================                  |  75%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nFound 101 outliers - those will be ignored in fitting/regularization step\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSecond step: Get residuals using fitted parameters for 12658 genes\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nComputing corrected count matrix for 12658 genes\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |=====                                                                 |   8%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |===========                                                           |  15%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |===================                                                   |  27%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |========================                                              |  35%\n  |                                                                            \n  |===========================                                           |  38%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |==============================================================        |  88%\n  |                                                                            \n  |=================================================================     |  92%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |======================================================================| 100%\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCalculating gene attributes\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWall clock passed: Time difference of 30.21689 secs\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nDetermine variable features\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nPlace corrected count matrix in counts slot\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nCentering data matrix\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nSet default assay to SCT\n```\n:::\n\n```{.r .cell-code}\nfeatures <- SelectIntegrationFeatures(object.list = ifnb.list, nfeatures = 3000)\nifnb.list <- PrepSCTIntegration(object.list = ifnb.list, anchor.features = features)\nifnb.list <- lapply(X = ifnb.list, FUN = RunPCA, features = features)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nPC_ 1 \nPositive:  FTL, TIMP1, IL8, CCL2, FTH1, C15orf48, S100A8, SOD2, ACTB, S100A9 \n\t   LYZ, FCER1G, TYROBP, S100A4, HLA-DRA, CD63, CD14, S100A11, LGALS3, ANXA5 \n\t   LGALS1, CXCL3, S100A10, IL1B, CTSL, PLAUR, CTSB, TYMP, S100A6, CST3 \nNegative:  RPL3, RPS18, RPS6, LTB, RPL13, CCR7, GIMAP7, RPL13A, PTMA, CXCR4 \n\t   RPSA, RPS2, RPL21, CD3D, RPS5, LDHB, NPM1, RPS4X, CCL5, RPS3 \n\t   TMEM66, RPS14, RPS27, PABPC1, RPL10A, RPS15A, RPL5, RPL32, RPS19, RPL34 \nPC_ 2 \nPositive:  CCL2, CCL5, GNLY, S100A8, NKG7, FTL, S100A9, GZMB, GIMAP7, CD7 \n\t   CD3D, CD14, FTH1, IL8, CXCL3, CD2, FGFBP2, CCL7, RGCC, RARRES3 \n\t   GZMH, APOBEC3G, TMEM66, CLIC3, ITM2A, CTSL, LTB, IL32, LCK, GIMAP5 \nNegative:  HLA-DRA, CD74, HLA-DQA1, HLA-DPA1, HLA-DRB1, HLA-DPB1, HLA-DQB1, CD83, TXN, CCR7 \n\t   CCL22, HLA-DMA, IDO1, ACTB, HERPUD1, LYZ, SYNGR2, CD79A, MIR155HG, BIRC3 \n\t   PKIB, RAB9A, SERPINB1, RAMP1, GPR183, CST3, FABP5, HLA-DRB5, TVP23A, ID2 \nPC_ 3 \nPositive:  RPS18, RPL13, LTB, RPS6, FTL, RPL3, RPL32, RPL10, RPS2, PABPC1 \n\t   RPL34, RPL13A, RPS14, RPS4X, RPL21, S100A8, CCL2, RPS12, RPL11, RPL7 \n\t   RPS3A, RPL18A, LDHB, SELL, RPS15A, RPS3, RPS8, S100A9, RPS5, RPS27A \nNegative:  GNLY, NKG7, CCL5, GZMB, CST7, APOBEC3G, FGFBP2, CLIC3, GZMH, KLRD1 \n\t   GZMA, CTSW, PRF1, HOPX, KLRC1, CHST12, TNFRSF18, CCL4, VMO1, FCGR3A \n\t   DUSP2, LDHA, CXCR3, C1orf21, ID2, MATK, SPON2, SH2D1B, RARRES3, APMAP \nPC_ 4 \nPositive:  HSPB1, HSP90AB1, HSPE1, CACYBP, CCL2, HSPA8, CREM, HSPD1, SRSF7, HSPH1 \n\t   HSPA1A, FTL, CD69, UBB, GADD45B, UBC, SRSF2, ZFAND2A, HSP90AA1, IL8 \n\t   NOP58, DDIT4, NR4A2, CHORDC1, H3F3B, BTG1, RSRC2, DNAJB1, SNHG15, YPEL5 \nNegative:  VMO1, FCGR3A, TIMP1, MS4A7, RPL3, FAM26F, TNFSF10, RPS4X, RPS2, RPS19 \n\t   RPL10, RPS18, PLAC8, CXCL16, CXCL10, HLA-DPA1, LST1, HLA-DPB1, RPL13, TNFSF13B \n\t   MS4A4A, RPS14, IFITM3, HN1, AIF1, GBP5, RPS6, CCL5, CD74, GBP1 \nPC_ 5 \nPositive:  CCL2, FTL, GNLY, CCL5, NKG7, IL8, GZMB, S100A8, S100A9, LYZ \n\t   HLA-DRA, CST7, CD74, HLA-DQA1, CXCL3, TXN, FGFBP2, CD63, GAPDH, CLIC3 \n\t   IL1B, HLA-DPB1, HLA-DRB1, VIM, RPL3, GZMH, CCL7, APOBEC3G, C15orf48, HLA-DQB1 \nNegative:  VMO1, FCGR3A, MS4A7, TIMP1, FAM26F, TNFSF10, CXCL10, HSPB1, IFITM3, GBP1 \n\t   AIF1, PLAC8, MS4A4A, LST1, GBP5, CXCL16, HN1, SAT1, ATP1B3, OAS1 \n\t   ISG15, C3AR1, WARS, CTSC, PPM1N, RGS2, TNFSF13B, SOD2, IFIT3, FGL2 \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nPC_ 1 \nPositive:  FTL, CXCL10, CCL2, CCL8, APOBEC3A, SOD2, TIMP1, C15orf48, CCL7, APOBEC3B \n\t   ISG15, IDO1, CCL3, IFITM3, CXCL11, LYZ, TYROBP, CCL4, IFI27, FCER1G \n\t   FTH1, CTSL, SAT1, TYMP, IL1RN, LGALS3, S100A11, CTSC, CD63, LGALS1 \nNegative:  RPL3, RPS6, RPS18, RPL13, RPL21, RPL7, RPL13A, CCR7, RPL10A, RPS4X \n\t   RPS2, GIMAP7, RPS3, RPS3A, RPS14, RPS27A, PTMA, RPL10, RPS15A, RPL34 \n\t   RPS5, RPL32, PABPC1, RPL5, CXCR4, RPS27, RPL31, LTB, MALAT1, RPL14 \nPC_ 2 \nPositive:  CCL2, CCL8, CCL7, RPS18, RPL13, RPS6, FTL, RPL3, RPL32, SELL \n\t   RPS14, RPL34, LTB, RPL7, RPL13A, RPL21, RPL10, GIMAP7, PABPC1, RPS2 \n\t   RPS4X, APOBEC3B, RPL10A, RPS15A, RPS3A, LDHB, S100A9, RPS12, RPL35A, RPL31 \nNegative:  GNLY, GZMB, NKG7, CCL5, PRF1, CD74, CLIC3, CST7, GZMA, HLA-DRA \n\t   APOBEC3G, GZMH, HLA-DPB1, HLA-DPA1, KLRD1, CTSW, TXN, FCGR3A, HLA-DQA1, VMO1 \n\t   HLA-DRB1, FASLG, ID2, FGFBP2, CD83, KLRC1, MS4A7, HLA-DQB1, RARRES3, TIMP1 \nPC_ 3 \nPositive:  CD74, HLA-DRA, HLA-DPB1, CXCL10, HLA-DPA1, HLA-DQA1, HLA-DRB1, TXN, TIMP1, CD83 \n\t   VMO1, FCGR3A, CCR7, HLA-DQB1, MS4A7, MARCKSL1, IRF8, CST3, BIRC3, SYNGR2 \n\t   MS4A4A, SERPINB1, CD79A, CXCL16, CD86, MIR155HG, HLA-DMA, CCL22, ACTB, FAM26F \nNegative:  GNLY, CCL2, CCL8, NKG7, CCL5, GZMB, CCL7, PRF1, GZMA, GZMH \n\t   CLIC3, KLRD1, CTSW, RARRES3, S100A9, ALOX5AP, FASLG, APOBEC3G, FGFBP2, CTSL \n\t   CD7, CCL4, KLRC1, CST7, S100A8, ANXA1, CCL3, CD247, IL32, LGALS3 \nPC_ 4 \nPositive:  FCGR3A, VMO1, MS4A7, TIMP1, MS4A4A, CXCL16, FAM26F, PLAC8, TNFSF10, TNFAIP6 \n\t   C3AR1, LST1, FTH1, CXCL10, TYROBP, CTSC, AIF1, GBP5, PPM1N, CFD \n\t   MT2A, CDKN1C, SERPINA1, IFITM3, SLC31A2, HN1, PLAUR, FCER1G, FCGR3B, EDN1 \nNegative:  CCL2, CCL8, CD74, HLA-DRA, TXN, HLA-DQA1, CCL7, HLA-DPB1, FTL, HLA-DRB1 \n\t   LYZ, MIR155HG, HLA-DQB1, CD83, IRF8, FABP5, CCR7, MARCKSL1, BIRC3, APOBEC3B \n\t   TSPAN13, HERPUD1, HSPE1, HSPD1, HLA-DPA1, ID3, PMAIP1, HSP90AB1, CD79A, NME1 \nPC_ 5 \nPositive:  CD74, HLA-DPB1, HLA-DRA, RPL3, TXN, RPS18, RPS4X, MARCKSL1, HLA-DPA1, RPL10 \n\t   RPL13, LYZ, HLA-DRB1, FTL, RPS2, GNLY, RPS14, GZMB, CCL5, RPS3 \n\t   RPL34, NKG7, RPL11, RPL13A, CST3, RPL32, RPS6, RPL21, HLA-DQA1, LSP1 \nNegative:  CCL4, CCL3, CD69, SRSF7, HSPE1, HSP90AB1, CACYBP, HSPA8, HSPD1, SRSF2 \n\t   DDIT4, CREM, GADD45B, UBC, NOP58, UBB, HSPH1, TCP1, JUNB, SOD1 \n\t   SAT1, CLK1, RSRC2, BTG1, DNAJB6, NR4A2, MYC, IRF1, DNAJB1, BATF \n```\n:::\n:::\n\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªæ•°æ®é›†è¿›è¡Œæ•´åˆã€‚æ•´åˆä¾èµ–äºåœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸­éƒ½å­˜åœ¨çš„é«˜å˜é‡ç‰¹å¾ï¼Œå¹¶ä¸”åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ã€‚ç¬¬ä¸€æ­¥FindIntegrationAnchorså®šä¹‰é”šç‚¹æˆ–ç»†èƒå¯¹ï¼ˆæ¯ä¸ªæ ·æœ¬ä¸­å„é€‰æ‹©ä¸€ä¸ªç»†èƒï¼‰ï¼Œè¿™äº›ç»†èƒéå¸¸ç›¸ä¼¼ï¼Œå› æ­¤å¯ä»¥æœ‰ä¿¡å¿ƒåœ°å°†å®ƒä»¬åˆ†é…åˆ°ç›¸åŒçš„ç°‡ï¼ˆç»†èƒç±»å‹å’ŒçŠ¶æ€ï¼‰ã€‚ç¬¬äºŒæ­¥IntegrateDataä½¿ç”¨æ‰€å®šä¹‰çš„é”šç‚¹å¯¹é½å®Œæ•´çš„æ•°æ®é›†ã€‚æœ‰å…³æ•´åˆæ–¹æ³•çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œè‡ªåŸå§‹Seuratè®ºæ–‡ä»¥æ¥çš„æ”¹è¿›å¯ä»¥åœ¨ä»–ä»¬[æœ€è¿‘çš„å‡ºç‰ˆç‰©](https://pubmed.ncbi.nlm.nih.gov/34062119/)ä¸­æ‰¾åˆ°ã€‚\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimmune.anchors <- FindIntegrationAnchors(object.list = ifnb.list, normalization.method = \"SCT\", anchor.features = features, dims = 1:30, reduction = \"rpca\", k.anchor = 20)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nComputing within dataset neighborhoods\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nFinding all pairwise anchors\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nProjecting new data onto SVD\nProjecting new data onto SVD\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nFinding neighborhoods\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nFinding anchors\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\tFound 32565 anchors\n```\n:::\n\n```{.r .cell-code}\nimmune.combined.sct <- IntegrateData(anchorset = immune.anchors, normalization.method = \"SCT\", dims = 1:30)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nMerging dataset 1 into 2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nExtracting anchors for merged samples\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nFinding integration vectors\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nFinding integration vector weights\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nIntegrating data\n```\n:::\n:::\n\n\næ•´åˆåçš„å¯¹è±¡åŒ…å«ç»è¿‡æ‰¹æ¬¡æ•ˆåº”æ ¡æ­£çš„å€¼ï¼Œä»¥åŠåŸå§‹è®¡æ•°å€¼ä½œä¸ºå•ç‹¬çš„æµ‹å®šã€‚\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimmune.combined.sct <- RunPCA(immune.combined.sct, verbose = FALSE)\nimmune.combined.sct <- RunUMAP(immune.combined.sct, reduction = \"pca\", dims = 1:30)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric\nTo use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation'\nThis message will be shown once per session\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n15:39:33 UMAP embedding parameters a = 0.9922 b = 1.112\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n15:39:33 Read 13999 rows and found 30 numeric columns\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n15:39:33 Using Annoy for neighbor search, n_neighbors = 30\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n15:39:33 Building Annoy index with metric = cosine, n_trees = 50\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n0%   10   20   30   40   50   60   70   80   90   100%\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n[----|----|----|----|----|----|----|----|----|----|\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n**************************************************|\n15:39:35 Writing NN index file to temp file /var/folders/bj/nw1w4g1j37ddpgb6zmh3sfh80000gn/T//RtmpF254ot/file1575b69d2520a\n15:39:35 Searching Annoy index using 1 thread, search_k = 3000\n15:39:38 Annoy recall = 100%\n15:39:39 Commencing smooth kNN distance calibration using 1 thread with target n_neighbors = 30\n15:39:40 Initializing from normalized Laplacian + noise (using irlba)\n15:39:41 Commencing optimization for 200 epochs, with 600044 positive edges\n15:39:49 Optimization finished\n```\n:::\n:::\n\n\nå¯è§†åŒ–ï¼š\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- DimPlot(immune.combined.sct, reduction = \"umap\", group.by = \"stim\")\np2 <- DimPlot(immune.combined.sct, reduction = \"umap\", group.by = \"seurat_annotations\", label = TRUE,\n    repel = TRUE)\np1 + p2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## ç»†èƒç›¸äº’ä½œç”¨åˆ†æ\n\n[NicheNet](https://pubmed.ncbi.nlm.nih.gov/31819264/)æ—¨åœ¨é€šè¿‡å°†ç‰¹å®šç°‡çš„å•ç»†èƒè¡¨è¾¾æ•°æ®ä¸å…³äºé…ä½“-å—ä½“å¯¹å’Œç›®æ ‡ä¸‹æ¸¸çš„åŸºå› è°ƒæ§ç½‘ç»œçš„å…ˆéªŒçŸ¥è¯†ç›¸ç»“åˆï¼Œé¢„æµ‹é…ä½“å’Œç›®æ ‡ç»†èƒä¹‹é—´çš„ç›¸äº’ä½œç”¨è¿æ¥ã€‚ç‰¹åˆ«åœ°ï¼Œå®ƒæ—¨åœ¨å®šä¹‰èƒ½å¤Ÿæœ€å¥½è§£é‡Šç›®æ ‡ç°‡ä¸­è§‚å¯Ÿåˆ°çš„å·®å¼‚è¡¨è¾¾çš„é…ä½“ã€‚\n\næˆ‘ä»¬é¦–å…ˆåŠ è½½å¿…è¦çš„Rè½¯ä»¶åŒ…ã€‚âš ï¸åœ¨æˆ‘åŠ è½½äº†NicheNetè½¯ä»¶åŒ…åï¼Œéƒ¨åˆ†Seuratæ•´åˆå‘½ä»¤æœªèƒ½æˆåŠŸæ‰§è¡Œã€‚ä¸¤ä¸ªè½¯ä»¶åŒ…ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸€äº›ä¸å…¼å®¹æ€§ã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(nichenetr)\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nâ”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€\nâœ” dplyr     1.1.2     âœ” readr     2.1.4\nâœ” forcats   1.0.0     âœ” stringr   1.5.0\nâœ” ggplot2   3.4.2     âœ” tibble    3.2.1\nâœ” lubridate 1.9.2     âœ” tidyr     1.3.0\nâœ” purrr     1.0.1     \nâ”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€\nâœ– dplyr::filter() masks stats::filter()\nâœ– dplyr::lag()    masks stats::lag()\nâ„¹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n:::\n\n\nåŠ è½½æ•°æ®é›†ï¼š\n\n\n::: {.cell}\n\n```{.r .cell-code}\nligand_target_matrix = readRDS(\"/Users/wsx/Library/CloudStorage/OneDrive-shanghaitech.edu.cn/Public/data/ligand_target_matrix.rds\")\nligand_target_matrix[1:5,1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                CXCL1        CXCL2        CXCL3        CXCL5         PPBP\nA1BG     3.534343e-04 4.041324e-04 3.729920e-04 3.080640e-04 2.628388e-04\nA1BG-AS1 1.650894e-04 1.509213e-04 1.583594e-04 1.317253e-04 1.231819e-04\nA1CF     5.787175e-04 4.596295e-04 3.895907e-04 3.293275e-04 3.211944e-04\nA2M      6.027058e-04 5.996617e-04 5.164365e-04 4.517236e-04 4.590521e-04\nA2M-AS1  8.898724e-05 8.243341e-05 7.484018e-05 4.912514e-05 5.120439e-05\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlr_network = readRDS(\"/Users/wsx/Library/CloudStorage/OneDrive-shanghaitech.edu.cn/Public/data/lr_network.rds\")\nhead(lr_network)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 Ã— 4\n  from  to    source         database\n  <chr> <chr> <chr>          <chr>   \n1 CXCL1 CXCR2 kegg_cytokines kegg    \n2 CXCL2 CXCR2 kegg_cytokines kegg    \n3 CXCL3 CXCR2 kegg_cytokines kegg    \n4 CXCL5 CXCR2 kegg_cytokines kegg    \n5 PPBP  CXCR2 kegg_cytokines kegg    \n6 CXCL6 CXCR2 kegg_cytokines kegg    \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nweighted_networks = readRDS(\"/Users/wsx/Library/CloudStorage/OneDrive-shanghaitech.edu.cn/Public/data/weighted_networks.rds\")\nweighted_networks_lr = weighted_networks$lr_sig %>% inner_join(lr_network %>% distinct(from,to), by = c(\"from\",\"to\"))\nhead(weighted_networks$lr_sig) # interactions and their weights in the ligand-receptor + signaling network\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 Ã— 3\n  from  to     weight\n  <chr> <chr>   <dbl>\n1 A1BG  ABCC6  0.422 \n2 A1BG  ACE2   0.101 \n3 A1BG  ADAM10 0.0970\n4 A1BG  AGO1   0.0525\n5 A1BG  AKT1   0.0855\n6 A1BG  ANXA7  0.457 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nIdents(immune.combined.sct) <-immune.combined.sct$seurat_annotations\nDefaultAssay(immune.combined.sct) <- \"integrated\"\n```\n:::\n\n\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¾èµ–äºæ•°æ®æä¾›çš„ç­›é€‰ç»†èƒæ³¨é‡Šã€‚\næˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨CD8 Tç»†èƒä½œä¸ºæ¥æ”¶ç»†èƒï¼Œå¹¶å¯»æ‰¾pDCã€CD14 Monoã€CD16 Monoã€NKã€Bã€DCã€B Activatedç¾¤é›†ä¸­çš„å‘é€å™¨é…ä½“ã€‚\n\næˆ‘ä»¬å®šä¹‰æ¥æ”¶ç»†èƒå’Œå‘é€å™¨ç»†èƒç¾¤ä½“ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è¯†åˆ«åœ¨æ¥æ”¶ç»†èƒä¸­è¡¨è¾¾çš„åŸºå› ï¼Œè¿™äº›åŸºå› ä¹Ÿæ˜¯æˆ‘ä»¬çŸ¥è¯†åº“çš„ä¸€éƒ¨åˆ†ã€‚\n\nğŸ’¡å¦‚æœæŸä¸ªåŸºå› åœ¨æ•°æ®åº“ä¸­æ²¡æœ‰è¢«çŸ¥é“ç”±ä»»ä½•é…ä½“è°ƒæ§ï¼Œè¯¥æ–¹æ³•å°†æ— æ³•åœ¨å…¶é¢„æµ‹ä¸­ä½¿ç”¨å®ƒã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreceiver = \"CD8 T\"\nexpressed_genes_receiver = get_expressed_genes(receiver, immune.combined.sct, pct = 0.10, assay_oi=\"RNA\")\nbackground_expressed_genes = expressed_genes_receiver %>% .[. %in% rownames(ligand_target_matrix)]\n\nsender_celltypes = c(\"pDC\", \"CD14 Mono\" ,  \"CD16 Mono\",  \"NK\", \"B\", \"DC\", \"B Activated\")\n\nlist_expressed_genes_sender = sender_celltypes %>% unique() %>% lapply(get_expressed_genes, immune.combined.sct, 0.10, assay_oi=\"RNA\") \nexpressed_genes_sender = list_expressed_genes_sender %>% unlist() %>% unique()\n```\n:::\n\n\nå®šä¹‰æ¥æ”¶ç»†èƒä¸­ç›¸å¯¹äºæ ·æœ¬å¤„ç†çš„å·®å¼‚åŸºå› ã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseurat_obj_receiver= subset(immune.combined.sct, idents = receiver)\nseurat_obj_receiver = SetIdent(immune.combined.sct, value = seurat_obj_receiver[[\"orig.ident\"]])\n\ncondition_oi = \"IMMUNE_STIM\"\ncondition_reference = \"IMMUNE_CTRL\" \n\nDE_table_receiver = FindMarkers(object = seurat_obj_receiver, ident.1 = condition_oi, ident.2 = condition_reference, min.pct = 0.10, assay=\"RNA\") %>% rownames_to_column(\"gene\")\n\ngeneset_oi = DE_table_receiver %>% filter(p_val <= 0.05 & abs(avg_log2FC) >= 0.25) %>% pull(gene)\ngeneset_oi = geneset_oi %>% .[. %in% rownames(ligand_target_matrix)]\n```\n:::\n\n\nå®šä¹‰åœ¨å„è‡ªç¾¤é›†ä¸­è¡¨è¾¾çš„é…ä½“å’Œå—ä½“åŸºå› ã€‚æ½œåœ¨çš„é…ä½“é›†è¢«ç¼©å°ä¸ºåœ¨æ¥æ”¶ç»†èƒç¾¤é›†ä¸­è¡¨è¾¾çš„å…·æœ‰é¶æ ‡çš„é…ä½“ã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nligands = lr_network %>% pull(from) %>% unique()\nreceptors = lr_network %>% pull(to) %>% unique()\n\nexpressed_ligands = intersect(ligands,expressed_genes_sender)\nexpressed_receptors = intersect(receptors,expressed_genes_receiver)\n\npotential_ligands = lr_network %>% filter(from %in% expressed_ligands & to %in% expressed_receptors) %>% pull(from) %>% unique()\n```\n:::\n\n\nNicheNetçš„é…ä½“æ´»æ€§åˆ†ææ ¹æ®æ¥æ”¶ç»†èƒä¸­å­˜åœ¨çš„è¡¨è¾¾é¶æ ‡åŸºå› çš„æƒ…å†µå¯¹é…ä½“è¿›è¡Œæ’åã€‚\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ligand_activities = predict_ligand_activities(geneset = geneset_oi, background_expressed_genes = background_expressed_genes, ligand_target_matrix = ligand_target_matrix, potential_ligands = potential_ligands)\n\n# ligand_activities = ligand_activities %>% arrange(-pearson) %>% mutate(rank = rank(desc(pearson)))\n# ligand_activities\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}